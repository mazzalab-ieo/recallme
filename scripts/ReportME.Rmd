---
title: "ReportME"
output: 
  flexdashboard::flex_dashboard:
    navbar:
      - { icon: "fa-github", href: "https://github.com/mazzalab-ieo/recallme", align: right}
params:
  query: ""
  TP_snv: ""
  TP_indels: ""
  FP_snv: "" 
  FP_indels: ""
  FN_snv: ""
  FN_indels: ""
  metrics_snv: ""
  metrics_indel: ""
  caller: ""
---
<style>
.navbar {
  background-color:steelblue;
}

.navbar-inverse .navbar-nav > li > a:hover,
.navbar-inverse .navbar-nav > li > a:focus {
    background-color: lightblue;
    color: white;
}
.navbar-inverse .navbar-nav > .active > a,
.navbar-inverse .navbar-nav > .active > a:hover,
.navbar-inverse .navbar-nav > .active > a:focus {
  color: white;
  background-color: lightblue;
}
.navbar-inverse .navbar-toggle:hover,
.navbar-inverse .navbar-toggle:focus {
  background-color: lightblue;
}
.navbar-inverse .navbar-collapse,
.navbar-inverse .navbar-form {
  border-color: lightblue;
}
.dataTables_scrollBody {
    height:100px !important;
    max-height:100px !important;
}
.chart-stage-flex {
    overflow:auto !important;
}
</style>

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(DT)
#library(reactable)
#library(optparse)
source("functions.R")
query <- read.delim(params$query
                    , sep = "\t"
                    , header = F)

TP_snv <- read.delim(params$TP_snv
                 , sep = " "
                 , header = F)
TP_indel <- read.delim(params$TP_indels
                 , sep = " "
                 , header = F)

FP_snv <- read.delim(params$FP_snv
                 , sep = " "
                 , header = F)

FP_indel <- read.delim(params$FP_indels
                 , sep = " "
                 , header = F)

FN_snv <- read.delim(params$FN_snv
                 , sep = " "
                 , header = F)

FN_indel <- read.delim(params$FN_indels
                 , sep = " "
                 , header = F)

metrics_bioinfo_snv <- read.delim(params$metrics_snv
                      , sep = "\t"
                      , header = T)

metrics_bioinfo_indel <- read.delim(params$metrics_indel
                      , sep = "\t"
                      , header = T)

colnames(query)[ncol(query)] <- "type"
#SNV metrics
tps_snv <- dplyr::left_join(TP_snv, query, by = c("V1", "V2", "V3", "V4", "V5"))
tps_snv <- tps_snv[!duplicated(tps_snv),]
fps_snv <- dplyr::left_join(FP_snv, query, by = c("V1", "V2", "V3", "V4", "V5"))
fps_snv <- fps_snv[!duplicated(fps_snv),]
fns_snv <- dplyr::left_join(FN_snv, query, by = c("V1", "V2", "V3", "V4", "V5"))
fns_snv <- fns_snv[!duplicated(fns_snv),]

if (params$caller == "GATK" || params$caller == "TVC" || params$caller == "LoFreq"){
  vaf = str_match_all(tps_snv$V13, "AF(.*?);")
  vaf = sapply(vaf, "[[", 1)
  vaf = sapply(str_split(vaf, "AF="), "[[",2)
  vaf = as.numeric(sapply(str_split(vaf, ";"), "[[",1))
  
  dp = str_match_all(tps_snv$V13, "DP(.*?);")
  dp = sapply(dp, "[[", 1)
  dp = sapply(str_split(dp, "DP="), "[[",2)
  dp = as.numeric(sapply(str_split(dp, ";"), "[[",1))
  
  qd = str_match_all(tps_snv$V13, "QD(.*?);")
  qd = sapply(qd, "[", 1)
  qd = sapply(str_split(qd, "QD="), "[",2)
  qd = as.numeric(sapply(str_split(qd, ";"), "[",1))

  ao = str_match_all(tps_snv$V13, "AO(.*?);")
  ao = sapply(ao, "[", 1)
  ao = sapply(str_split(ao, "AO="), "[",2)
  ao = as.numeric(sapply(str_split(ao, ";"), "[",1))
  
  ro = str_match_all(tps_snv$V13, "RO(.*?);")
  ro = sapply(ro, "[", 1)
  ro = sapply(str_split(ro, "RO="), "[",2)
  ro = as.numeric(sapply(str_split(ro, ";"), "[",1))

  sssb = str_match_all(tps_snv$V13, "SSSB(.*?);")
  sssb = sapply(sssb, "[", 1)
  sssb = sapply(str_split(sssb, "SSSB="), "[",2)
  sssb = as.numeric(sapply(str_split(sssb, ";"), "[",1))
  
  stb = str_match_all(tps_snv$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  stbp = str_match_all(tps_snv$V13, "STBP(.*?);")
  stbp = sapply(stbp, "[", 1)
  stbp = sapply(str_split(stbp, "STBP="), "[",2)
  stbp = as.numeric(sapply(str_split(stbp, ";"), "[",1))

  if(dim(tps_snv)[1] == length(vaf)) tps_snv$VAF = vaf else print("Not same length. Skipping...")
  if(dim(tps_snv)[1] == length(dp)) tps_snv$DP = dp else print("Not same length. Skipping...")
  if(dim(tps_snv)[1] == length(qd)) tps_snv$QD = qd else print("Not same length. Skipping...")
  if(dim(tps_snv)[1] == length(stb)) tps_snv$STB = stb else print("Not same length. Skipping...")
  if(dim(tps_snv)[1] == length(ao)) tps_snv$AO = ao else print("Not same length. Skipping...")
  if(dim(tps_snv)[1] == length(ro)) tps_snv$RO = ro else print("Not same length. Skipping...")
  if(dim(tps_snv)[1] == length(stbp)) tps_snv$STBP = stbp else print("Not same length. Skipping...")
  if(dim(tps_snv)[1] == length(sssb)) tps_snv$SSSB = sssb else print("Not same length. Skipping...")
  
  vaf = str_match_all(fps_snv$V13, "AF(.*?);")
  vaf = sapply(vaf, "[[", 1)
  vaf = sapply(str_split(vaf, "AF="), "[[",2)
  vaf = as.numeric(sapply(str_split(vaf, ";"), "[[",1))
  
  dp = str_match_all(fps_snv$V13, "DP(.*?);")
  dp = sapply(dp, "[[", 1)
  dp = sapply(str_split(dp, "DP="), "[[",2)
  dp = as.numeric(sapply(str_split(dp, ";"), "[[",1))
  
  qd = str_match_all(fps_snv$V13, "QD(.*?);")
  qd = sapply(qd, "[", 1)
  qd = sapply(str_split(qd, "QD="), "[",2)
  qd = as.numeric(sapply(str_split(qd, ";"), "[",1))

  ao = str_match_all(fps_snv$V13, "AO(.*?);")
  ao = sapply(ao, "[", 1)
  ao = sapply(str_split(ao, "AO="), "[",2)
  ao = as.numeric(sapply(str_split(ao, ";"), "[",1))
  
  ro = str_match_all(fps_snv$V13, "RO(.*?);")
  ro = sapply(ro, "[", 1)
  ro = sapply(str_split(ro, "RO="), "[",2)
  ro = as.numeric(sapply(str_split(ro, ";"), "[",1))

  sssb = str_match_all(fps_snv$V13, "SSSB(.*?);")
  sssb = sapply(sssb, "[", 1)
  sssb = sapply(str_split(sssb, "SSSB="), "[",2)
  sssb = as.numeric(sapply(str_split(sssb, ";"), "[",1))
  
  stb = str_match_all(fps_snv$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  stbp = str_match_all(fps_snv$V13, "STBP(.*?);")
  stbp = sapply(stbp, "[", 1)
  stbp = sapply(str_split(stbp, "STBP="), "[",2)
  stbp = as.numeric(sapply(str_split(stbp, ";"), "[",1))
  
  if(dim(fps_snv)[1] == length(vaf)) fps_snv$VAF = vaf else print("Not same length. Skipping...")
  if(dim(fps_snv)[1] == length(dp)) fps_snv$DP = dp else print("Not same length. Skipping...")
  if(dim(fps_snv)[1] == length(qd)) fps_snv$QD = qd else print("Not same length. Skipping...")
  if(dim(fps_snv)[1] == length(stb)) fps_snv$STB = stb else print("Not same length. Skipping...")
  if(dim(fps_snv)[1] == length(ao)) fps_snv$AO = ao else print("Not same length. Skipping...")
  if(dim(fps_snv)[1] == length(ro)) fps_snv$RO = ro else print("Not same length. Skipping...")
  if(dim(fps_snv)[1] == length(stbp)) fps_snv$STBP = stbp else print("Not same length. Skipping...")
  if(dim(fps_snv)[1] == length(sssb)) fps_snv$SSSB = sssb else print("Not same length. Skipping...")
  
  query_snv <- query %>% filter(type == "SNV")
  vaf = str_match_all(query_snv$V13, "AF(.*?);")
  vaf = sapply(vaf, "[[", 1)
  vaf = sapply(str_split(vaf, "AF="), "[[",2)
  vaf = as.numeric(sapply(str_split(vaf, ";"), "[[",1))
  
  dp = str_match_all(query_snv$V13, "DP(.*?);")
  dp = sapply(dp, "[[", 1)
  dp = sapply(str_split(dp, "DP="), "[[",2)
  dp = as.numeric(sapply(str_split(dp, ";"), "[[",1))
  
  qd = str_match_all(query_snv$V13, "QD(.*?);")
  qd = sapply(qd, "[", 1)
  qd = sapply(str_split(qd, "QD="), "[",2)
  qd = as.numeric(sapply(str_split(qd, ";"), "[",1))
  
  stb = str_match_all(query_snv$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  ao = str_match_all(query_snv$V13, "AO(.*?);")
  ao = sapply(ao, "[", 1)
  ao = sapply(str_split(ao, "AO="), "[",2)
  ao = as.numeric(sapply(str_split(ao, ";"), "[",1))
  
  ro = str_match_all(query_snv$V13, "RO(.*?);")
  ro = sapply(ro, "[", 1)
  ro = sapply(str_split(ro, "RO="), "[",2)
  ro = as.numeric(sapply(str_split(ro, ";"), "[",1))

  sssb = str_match_all(query_snv$V13, "SSSB(.*?);")
  sssb = sapply(sssb, "[", 1)
  sssb = sapply(str_split(sssb, "SSSB="), "[",2)
  sssb = as.numeric(sapply(str_split(sssb, ";"), "[",1))
  
  stb = str_match_all(query_snv$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  stbp = str_match_all(query_snv$V13, "STBP(.*?);")
  stbp = sapply(stbp, "[", 1)
  stbp = sapply(str_split(stbp, "STBP="), "[",2)
  stbp = as.numeric(sapply(str_split(stbp, ";"), "[",1))
  
  if(dim(query_snv)[1] == length(vaf)) query_snv$VAF = vaf else print("Not same length. Skipping...")
  if(dim(query_snv)[1] == length(dp)) query_snv$DP = dp else print("Not same length. Skipping...")
  if(dim(query_snv)[1] == length(qd)) query_snv$QD = qd else print("Not same length. Skipping...")
  if(dim(query_snv)[1] == length(stb)) query_snv$STB = stb else print("Not same length. Skipping...")
  if(dim(query_snv)[1] == length(ao)) query_snv$AO = ao else print("Not same length. Skipping...")
  if(dim(query_snv)[1] == length(ro)) query_snv$RO = ro else print("Not same length. Skipping...")
  if(dim(query_snv)[1] == length(stbp)) query_snv$STBP = stbp else print("Not same length. Skipping...")
  if(dim(query_snv)[1] == length(sssb)) query_snv$SSSB = sssb else print("Not same length. Skipping...") 
  
  #INDELs metrics
  tps_indel <- dplyr::left_join(TP_indel, query, by = c("V1", "V2", "V3", "V4", "V5"))
  tps_indel <- tps_indel[!duplicated(tps_indel),]
  fps_indel <- dplyr::left_join(FP_indel, query, by = c("V1", "V2", "V3", "V4", "V5"))
  fps_indel <- fps_indel[!duplicated(fps_indel),]
  fns_indel <- dplyr::left_join(FN_indel, query, by = c("V1", "V2", "V3", "V4", "V5"))
  fns_indel <- fns_indel[!duplicated(fns_indel),]
  
  vaf = str_match_all(tps_indel$V13, "AF(.*?);")
  vaf = sapply(vaf, "[[", 1)
  vaf = sapply(str_split(vaf, "AF="), "[[",2)
  vaf = as.numeric(sapply(str_split(vaf, ";"), "[[",1))
  
  dp = str_match_all(tps_indel$V13, "DP(.*?);")
  dp = sapply(dp, "[[", 1)
  dp = sapply(str_split(dp, "DP="), "[[",2)
  dp = as.numeric(sapply(str_split(dp, ";"), "[[",1))
  
  qd = str_match_all(tps_indel$V13, "QD(.*?);")
  qd = sapply(qd, "[", 1)
  qd = sapply(str_split(qd, "QD="), "[",2)
  qd = as.numeric(sapply(str_split(qd, ";"), "[",1))
  
  stb = str_match_all(tps_indel$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  ao = str_match_all(tps_indel$V13, "AO(.*?);")
  ao = sapply(ao, "[", 1)
  ao = sapply(str_split(ao, "AO="), "[",2)
  ao = as.numeric(sapply(str_split(ao, ";"), "[",1))
  
  ro = str_match_all(tps_indel$V13, "RO(.*?);")
  ro = sapply(ro, "[", 1)
  ro = sapply(str_split(ro, "RO="), "[",2)
  ro = as.numeric(sapply(str_split(ro, ";"), "[",1))

  sssb = str_match_all(tps_indel$V13, "SSSB(.*?);")
  sssb = sapply(sssb, "[", 1)
  sssb = sapply(str_split(sssb, "SSSB="), "[",2)
  sssb = as.numeric(sapply(str_split(sssb, ";"), "[",1))
  
  stb = str_match_all(tps_indel$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  stbp = str_match_all(tps_indel$V13, "STBP(.*?);")
  stbp = sapply(stbp, "[", 1)
  stbp = sapply(str_split(stbp, "STBP="), "[",2)
  stbp = as.numeric(sapply(str_split(stbp, ";"), "[",1))
  
  if(dim(tps_indel)[1] == length(vaf)) tps_indel$VAF = vaf else print("Not same length. Skipping...")
  if(dim(tps_indel)[1] == length(dp)) tps_indel$DP = dp else print("Not same length. Skipping...")
  if(dim(tps_indel)[1] == length(qd)) tps_indel$QD = qd else print("Not same length. Skipping...")
  if(dim(tps_indel)[1] == length(stb)) tps_indel$STB = stb else print("Not same length. Skipping...")
  if(dim(tps_indel)[1] == length(ao)) tps_indel$AO = ao else print("Not same length. Skipping...")
  if(dim(tps_indel)[1] == length(ro)) tps_indel$RO = ro else print("Not same length. Skipping...")
  if(dim(tps_indel)[1] == length(stbp)) tps_indel$STBP = stbp else print("Not same length. Skipping...")
  if(dim(tps_indel)[1] == length(sssb)) tps_indel$SSSB = sssb else print("Not same length. Skipping...")
  
  vaf = str_match_all(fps_indel$V13, "AF(.*?);")
  vaf = sapply(vaf, "[[", 1)
  vaf = sapply(str_split(vaf, "AF="), "[[",2)
  vaf = as.numeric(sapply(str_split(vaf, ";"), "[[",1))
  
  dp = str_match_all(fps_indel$V13, "DP(.*?);")
  dp = sapply(dp, "[[", 1)
  dp = sapply(str_split(dp, "DP="), "[[",2)
  dp = as.numeric(sapply(str_split(dp, ";"), "[[",1))
  
  qd = str_match_all(fps_indel$V13, "QD(.*?);")
  qd = sapply(qd, "[", 1)
  qd = sapply(str_split(qd, "QD="), "[",2)
  qd = as.numeric(sapply(str_split(qd, ";"), "[",1))
  
  stb = str_match_all(fps_indel$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  ao = str_match_all(fps_snv$V13, "AO(.*?);")
  ao = sapply(ao, "[", 1)
  ao = sapply(str_split(ao, "AO="), "[",2)
  ao = as.numeric(sapply(str_split(ao, ";"), "[",1))
  
  ro = str_match_all(fps_snv$V13, "RO(.*?);")
  ro = sapply(ro, "[", 1)
  ro = sapply(str_split(ro, "RO="), "[",2)
  ro = as.numeric(sapply(str_split(ro, ";"), "[",1))

  sssb = str_match_all(fps_indel$V13, "SSSB(.*?);")
  sssb = sapply(sssb, "[", 1)
  sssb = sapply(str_split(sssb, "SSSB="), "[",2)
  sssb = as.numeric(sapply(str_split(sssb, ";"), "[",1))
  
  stb = str_match_all(fps_indel$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  stbp = str_match_all(fps_indel$V13, "STBP(.*?);")
  stbp = sapply(stbp, "[", 1)
  stbp = sapply(str_split(stbp, "STBP="), "[",2)
  stbp = as.numeric(sapply(str_split(stbp, ";"), "[",1))
  
  if(dim(fps_indel)[1] == length(vaf)) fps_indel$VAF = vaf else print("Not same length. Skipping...")
  if(dim(fps_indel)[1] == length(dp)) fps_indel$DP = dp else print("Not same length. Skipping...")
  if(dim(fps_indel)[1] == length(qd)) fps_indel$QD = qd else print("Not same length. Skipping...")
  if(dim(fps_indel)[1] == length(stb)) fps_indel$STB = stb else print("Not same length. Skipping...")
  if(dim(fps_indel)[1] == length(ao)) fps_indel$AO = ao else print("Not same length. Skipping...")
  if(dim(fps_indel)[1] == length(ro)) fps_indel$RO = ro else print("Not same length. Skipping...")
  if(dim(fps_indel)[1] == length(stbp)) fps_indel$STBP = stbp else print("Not same length. Skipping...")
  if(dim(fps_indel)[1] == length(sssb)) fps_indel$SSSB = sssb else print("Not same length. Skipping...")
  
  query_indel <- query %>% filter(type == "INDEL")
  vaf = str_match_all(query_indel$V13, "AF(.*?);")
  vaf = sapply(vaf, "[[", 1)
  vaf = sapply(str_split(vaf, "AF="), "[[",2)
  vaf = as.numeric(sapply(str_split(vaf, ";"), "[[",1))
  
  dp = str_match_all(query_indel$V13, "DP(.*?);")
  dp = sapply(dp, "[[", 1)
  dp = sapply(str_split(dp, "DP="), "[[",2)
  dp = as.numeric(sapply(str_split(dp, ";"), "[[",1))
  
  qd = str_match_all(query_indel$V13, "QD(.*?);")
  qd = sapply(qd, "[", 1)
  qd = sapply(str_split(qd, "QD="), "[",2)
  qd = as.numeric(sapply(str_split(qd, ";"), "[",1))
  
  stb = str_match_all(query_indel$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "stb="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  ao = str_match_all(query_snv$V13, "AO(.*?);")
  ao = sapply(ao, "[", 1)
  ao = sapply(str_split(ao, "AO="), "[",2)
  ao = as.numeric(sapply(str_split(ao, ";"), "[",1))
  
  ro = str_match_all(query_snv$V13, "RO(.*?);")
  ro = sapply(ro, "[", 1)
  ro = sapply(str_split(ro, "RO="), "[",2)
  ro = as.numeric(sapply(str_split(ro, ";"), "[",1))

  sssb = str_match_all(query_snv$V13, "SSSB(.*?);")
  sssb = sapply(sssb, "[", 1)
  sssb = sapply(str_split(sssb, "SSSB="), "[",2)
  sssb = as.numeric(sapply(str_split(sssb, ";"), "[",1))
  
  stb = str_match_all(query_snv$V13, "STB(.*?);")
  stb = sapply(stb, "[", 1)
  stb = sapply(str_split(stb, "STB="), "[",2)
  stb = as.numeric(sapply(str_split(stb, ";"), "[",1))

  stbp = str_match_all(query_snv$V13, "STBP(.*?);")
  stbp = sapply(stbp, "[", 1)
  stbp = sapply(str_split(stbp, "STBP="), "[",2)
  stbp = as.numeric(sapply(str_split(stbp, ";"), "[",1))

  if(dim(query_indel)[1] == length(vaf)) query_indel$VAF = vaf else print("Not same length. Skipping...")
  if(dim(query_indel)[1] == length(dp)) query_indel$DP = dp else print("Not same length. Skipping...")
  if(dim(query_indel)[1] == length(qd)) query_indel$QD = qd else print("Not same length. Skipping...")
  if(dim(query_indel)[1] == length(stb)) query_indel$STB = stb else print("Not same length. Skipping...")
  if(dim(query_indel)[1] == length(ao)) query_indel$AO = ao else print("Not same length. Skipping...")
  if(dim(query_indel)[1] == length(ro)) query_indel$RO = ro else print("Not same length. Skipping...")
  if(dim(query_indel)[1] == length(stbp)) query_indel$STBP = stbp else print("Not same length. Skipping...")
  if(dim(query_indel)[1] == length(sssb)) query_indel$SSSB = sssb else print("Not same length. Skipping...") 
    
}
tps_snv$class <- rep("TP", nrow(tps_snv))
tps_indel$class <- rep("TP", nrow(tps_indel))
fps_snv$class <- rep("FP", nrow(fps_snv))
fps_indel$class <- rep("FP", nrow(fps_indel))
#check if dataframes for TPs and FPs have same number of cols and then rowbind them
if (length(colnames(tps_snv)) < length(colnames(fps_snv))){
  fps_snv = fps_snv[,colnames(tps_snv)]
}else{
  tps_snv = tps_snv[,colnames(fps_snv)]
}
snvs <- rbind(tps_snv, fps_snv)

if (length(colnames(tps_indel)) < length(colnames(fps_indel))){
  fps_indel = fps_indel[,colnames(tps_indel)]
}else{
  tps_indel = tps_indel[,colnames(fps_indel)]
}
indels <- rbind(tps_indel, fps_indel)
```

SNVs {data-navmenu="Plots"}
=======================================================================

Row 
-----------------------------------------------------------------------

### Variants - Depth distribution

```{r}
p3<-plotly::ggplotly(ggplot(query_snv, aes(x=DP)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Depth", y=""))

p3
```

### True Positives - Depth distribution 

```{r}
p<-plotly::ggplotly(ggplot(tps_snv, aes(x=DP)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Depth", y=""))

p
```

### False Positives - Depth distribution

```{r}
p2<-plotly::ggplotly(ggplot(fps_snv, aes(x=DP)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Depth", y="" )) 


p2

```

Row 
-----------------------------------------------------------------------

### Variants - Quality by depth distribution

```{r}
p3<-plotly::ggplotly(ggplot(query_snv, aes(x=QD)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Quality by depth", y="")) 


p3
```

### True Positives - Quality by depth distribution

```{r}
p3<-plotly::ggplotly(ggplot(tps_snv, aes(x=QD)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Quality by depth", y="")) 


p3
```

### False Positives - Quality by depth distribution

```{r}
p2<-plotly::ggplotly(ggplot(fps_snv, aes(x=QD)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Quality by depth", y="" )) 


p2

```

Row 
-----------------------------------------------------------------------

### Variants - VAF distribution

```{r}
p3<-plotly::ggplotly(ggplot(query_snv, aes(x=VAF)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "VAF", y="")) 


p3
```


### True Positives - VAF distribution

```{r}
p3<-plotly::ggplotly(ggplot(tps_snv, aes(x=VAF)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "VAF", y="")) 


p3
```

### False Positives - VAF distribution

```{r}
p2<-plotly::ggplotly(ggplot(fps_snv, aes(x=VAF)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "VAF", y="" )) 


p2

```

Row 
-----------------------------------------------------------------------

INDELs {data-navmenu="Plots"}
=======================================================================

Row 
-----------------------------------------------------------------------

### Variants - Depth distribution

```{r}
p3<-plotly::ggplotly(ggplot(query_indel, aes(x=DP)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Depth", y=""))

p3
```

### True Positives - Depth distribution 

```{r}
p<-plotly::ggplotly(ggplot(tps_indel, aes(x=DP)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Depth", y=""))

p
```

### False Positives - Depth distribution

```{r}
p2<-plotly::ggplotly(ggplot(fps_indel, aes(x=DP)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Depth", y="" )) 


p2

```

Row 
-----------------------------------------------------------------------

### Variants - Quality by depth distribution

```{r}
p3<-plotly::ggplotly(ggplot(query_indel, aes(x=QD)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Quality by depth", y="")) 


p3
```

### True Positives - Quality by depth distribution

```{r}
p3<-plotly::ggplotly(ggplot(tps_indel, aes(x=QD)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Quality by depth", y="")) 


p3
```

### False Positives - Quality by depth distribution

```{r}
p2<-plotly::ggplotly(ggplot(fps_indel, aes(x=QD)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "Quality by depth", y="" )) 


p2

```

Row 
-----------------------------------------------------------------------

### Variants - VAF distribution

```{r}
p3<-plotly::ggplotly(ggplot(query_indel, aes(x=VAF)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "VAF", y="")) 


p3
```

### True Positives - VAF distribution

```{r}
p3<-plotly::ggplotly(ggplot(tps_indel, aes(x=VAF)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "VAF", y="")) 


p3
```

### False Positives - VAF distribution

```{r}
p2<-plotly::ggplotly(ggplot(fps_indel, aes(x=VAF)) +
  theme_classic() + 
  geom_histogram(bins = 100, color="steelblue", linetype="dashed", size=0.5) +theme(legend.position = "none") + 
  labs(x= "VAF", y="" )) 


p2

```

SNVs  {data-navmenu="Tables"}
=======================================================================

Row {data-height=150}
-----------------------------------------------------------------------

### Sample INFO - SNVs

```{r}
n_tps_snv <- dim(tps_snv)[1]
valueBox(n_tps_snv,caption = "TPs", color = "success")
```

### Sample INFO - SNVs

```{r}
n_fps_snv<- dim(fps_snv)[1]
valueBox(n_fps_snv,caption = "FPs", color = "warning")
```

### Sample INFO - SNVs

```{r}
n_fns_snv<- dim(fns_snv)[1]
valueBox(n_fns_snv,caption = "FNs", color = "danger")
```

### Metrics

```{r}
#reactable(as.data.frame(metrics_bioinfo_snv),wrap = F, filterable = T)
datatable(as.data.frame(metrics_bioinfo_snv), filter = "none", rownames = FALSE)
```

Column
-----------------------------------------------------------------------

### TPs variants

```{r}
colnames(tps_snv) <- c("Chr", "Start", "End", "Ref", "Alt", "Chr_VCF", "Pos", ".", "Ref_VCF", "Alt_VCF", "Quality", "Filter", "Info 1", "Info 2", "Info 3", "Type", "VAF", "DP", "QD" )
#reactable(as.data.frame(tps_snv),wrap = F, filterable = T)
datatable(as.data.frame(tps_snv), filter = "top", rownames = FALSE)
```

### FPs variants

```{r}
colnames(fps_snv) <- c("Chr", "Start", "End", "Ref", "Alt", "Chr_VCF", "Pos", ".", "Ref_VCF", "Alt_VCF", "Quality", "Filter", "Info 1", "Info 2", "Info 3", "Type", "VAF", "DP", "QD" )
#reactable(as.data.frame(fps_snv),wrap = F, filterable = T)
datatable(as.data.frame(fps_snv), filter = "top", rownames = FALSE)
```

### FNs variants

```{r}
fns_snv <- fns_snv[,c(1,2,3,4,5)]
colnames(fns_snv) <- c("Chr", "Start", "End", "Ref", "Alt")
#reactable(as.data.frame(fns_snv),wrap = F, filterable = T)
datatable(as.data.frame(fns_snv), filter = "top", rownames = FALSE)
```

INDELs {data-navmenu="Tables"}
=======================================================================

Row {data-height=150}
-----------------------------------------------------------------------

### Sample INFO - INDELs

```{r}
n_tps_indel <- dim(tps_indel)[1]
valueBox(n_tps_indel,caption = "TPs", color = "success")
```

### Sample INFO - INDELs

```{r}
n_fps_indel <- dim(fps_indel)[1]
valueBox(n_fps_indel,caption = "FPs", color = "warning")
```

### Sample INFO - SNVs

```{r}
n_fns_indel <- dim(fns_indel)[1]
valueBox(n_fns_indel,caption = "FNs", color = "danger")
```

### Metrics

```{r}
#reactable(as.data.frame(metrics_bioinfo_indel),wrap = F, filterable = T)
datatable(as.data.frame(metrics_bioinfo_indel), filter = "none", rownames = FALSE)
```

Column 
-----------------------------------------------------------------------

### TPs variants

```{r}
colnames(tps_indel) <- c("Chr", "Start", "End", "Ref", "Alt", "Chr_VCF", "Pos", ".", "Ref_VCF", "Alt_VCF", "Quality", "Filter", "Info 1", "Info 2", "Info 3", "Type", "VAF", "DP", "QD" )
#reactable(as.data.frame(tps_indel),wrap = F, filterable = T)
datatable(as.data.frame(tps_indel), filter = "top", rownames = FALSE)
```

### FPs variants

```{r}
colnames(fps_indel) <- c("Chr", "Start", "End", "Ref", "Alt", "Chr_VCF", "Pos", ".", "Ref_VCF", "Alt_VCF", "Quality", "Filter", "Info 1", "Info 2", "Info 3", "Type", "VAF", "DP", "QD" )
#reactable(as.data.frame(fps_indel),wrap = F, filterable = T)
datatable(as.data.frame(fps_indel), filter = "top", rownames = FALSE)
```

### FNs variants

```{r}
fns_indel <- fns_snv[,c(1,2,3,4,5)]
colnames(fns_indel) <- c("Chr", "Start", "End", "Ref", "Alt")
#reactable(as.data.frame(fns_indel),wrap = F, filterable = T)
datatable(as.data.frame(fns_indel), filter = "top", rownames = FALSE)
```

Params similarity SNVs {data-navmenu="Tables"}
=======================================================================

Column
-----------------------------------------------------------------------

### VAF

```{r}
if ("VAF" %in% colnames(tps_snv) & "VAF" %in% colnames(fps_snv)){
  jaccard_idx = jaccard(tps_snv$VAF, fps_snv$VAF)
  if (length(tps_snv$VAF) >= length(fps_snv$VAF)){
    cosine_sim = cosine_similarity(sample(tps_snv$VAF,length(fps_snv$VAF)), fps_snv$VAF)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("VAF data not available")
}

```

### DP

```{r}
if ("DP" %in% colnames(tps_snv) & "DP" %in% colnames(fps_snv)){
  jaccard_idx = jaccard(tps_snv$DP, fps_snv$DP)
  if (length(tps_snv$DP) >= length(fps_snv$DP)){
    cosine_sim = cosine_similarity(sample(tps_snv$DP,length(fps_snv$DP)), fps_snv$DP)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("DP data not available")
}
```

### QD

```{r}
if ("QD" %in% colnames(tps_snv) & "QD" %in% colnames(fps_snv)){
  jaccard_idx = jaccard(tps_snv$QD, fps_snv$QD)
  if (length(tps_snv$QD) >= length(fps_snv$QD)){
    cosine_sim = cosine_similarity(sample(tps_snv$QD,length(fps_snv$QD)), fps_snv$QD)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("QD data not available")
}
```

Column
-----------------------------------------------------------------------

### AO

```{r}
if ("AO" %in% colnames(tps_snv) & "AO" %in% colnames(fps_snv)){
  jaccard_idx = jaccard(tps_snv$AO, fps_snv$AO)
  if (length(tps_snv$AO) >= length(fps_snv$AO)){
    cosine_sim = cosine_similarity(sample(tps_snv$AO,length(fps_snv$AO)), fps_snv$AO)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("AO data not available")
}
```

### RO

```{r}
if ("RO" %in% colnames(tps_snv) & "RO" %in% colnames(fps_snv)){
  jaccard_idx = jaccard(tps_snv$RO, fps_snv$RO)
  if (length(tps_snv$RO) >= length(fps_snv$RO)){
    cosine_sim = cosine_similarity(sample(tps_snv$RO,length(fps_snv$RO)), fps_snv$RO)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("RO data not available")
}
```

### STB

```{r}
if ("STB" %in% colnames(tps_snv) & "STB" %in% colnames(fps_snv)){  
  jaccard_idx = jaccard(tps_snv$STB, fps_snv$STB)
  if (length(tps_snv$STB) >= length(fps_snv$STB)){
    cosine_sim = cosine_similarity(sample(tps_snv$STB,length(fps_snv$STB)), fps_snv$STB)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
  }else{
  print("STB data not available")
}
```

### STBP

```{r}
if ("STBP" %in% colnames(tps_snv) & "STBP" %in% colnames(fps_snv)){
  jaccard_idx = jaccard(tps_snv$STBP, fps_snv$STBP)
  if (length(tps_snv$STBP) >= length(fps_snv$STBP)){
    cosine_sim = cosine_similarity(sample(tps_snv$STBP,length(fps_snv$STBP)), fps_snv$STBP)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("STBP data not available")
}
```

### SSSB

```{r}
if ("SSSB" %in% colnames(tps_snv) & "SSSB" %in% colnames(fps_snv)){
  jaccard_idx = jaccard(tps_snv$SSSB, fps_snv$SSSB)
  if (length(tps_snv$SSSB) >= length(fps_snv$SSSB)){
    cosine_sim = cosine_similarity(sample(tps_snv$SSSB,length(fps_snv$SSSB)), fps_snv$SSSB)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("SSSB data not available")
}
```

Params similarity INDELs {data-navmenu="Tables"}
=======================================================================

Column
-----------------------------------------------------------------------

### VAF

```{r}
if ("VAF" %in% colnames(tps_indel) & "VAF" %in% colnames(fps_indel)){
  jaccard_idx = jaccard(tps_indel$VAF, fps_indel$VAF)
  if (length(tps_indel$VAF) >= length(fps_indel$VAF)){
    cosine_sim = cosine_similarity(sample(tps_indel$VAF,length(fps_indel$VAF)), fps_indel$VAF)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("VAF data not available")
}
```

### DP

```{r}
if ("DP" %in% colnames(tps_indel) & "DP" %in% colnames(fps_indel)){
  jaccard_idx = jaccard(tps_indel$DP, fps_indel$DP)
  if (length(tps_indel$DP) >= length(fps_indel$DP)){
    cosine_sim = cosine_similarity(sample(tps_indel$DP,length(fps_indel$DP)), fps_indel$DP)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("DP data not available")
}
```

### QD

```{r}
if ("QD" %in% colnames(tps_indel) & "QD" %in% colnames(fps_indel)){
  jaccard_idx = jaccard(tps_indel$QD, fps_indel$QD)
  if (length(tps_indel$QD) >= length(fps_indel$QD)){
    cosine_sim = cosine_similarity(sample(tps_indel$QD,length(fps_indel$QD)), fps_indel$QD)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("QD data not available")
}
```

Column
-----------------------------------------------------------------------

### AO

```{r}
if ("AO" %in% colnames(tps_indel) & "AO" %in% colnames(fps_indel)){
  jaccard_idx = jaccard(tps_indel$AO, fps_indel$AO)
  if (length(tps_indel$AO) >= length(fps_indel$AO)){
    cosine_sim = cosine_similarity(sample(tps_indel$AO,length(fps_indel$AO)), fps_indel$AO)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("AO data not available")
}
```

### RO

```{r}
if ("RO" %in% colnames(tps_indel) & "RO" %in% colnames(fps_indel)){
  jaccard_idx = jaccard(tps_indel$RO, fps_indel$RO)
  if (length(tps_indel$RO) >= length(fps_indel$RO)){
    cosine_sim = cosine_similarity(sample(tps_indel$RO,length(fps_indel$RO)), fps_indel$RO)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("RO data not available")
}
```

### STB

```{r}
if ("STB" %in% colnames(tps_indel) & "STB" %in% colnames(fps_indel)){
  jaccard_idx = jaccard(tps_indel$STB, fps_indel$STB)
  if (length(tps_indel$STB) >= length(fps_indel$STB)){
    cosine_sim = cosine_similarity(sample(tps_indel$STB,length(fps_indel$STB)), fps_indel$STB)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("STB data not available")
}
```

### STBP

```{r}
if ("STBP" %in% colnames(tps_indel) & "STBP" %in% colnames(fps_indel)){
  jaccard_idx = jaccard(tps_indel$STBP, fps_indel$STBP)
  if (length(tps_indel$STBP) >= length(fps_indel$STBP)){
    cosine_sim = cosine_similarity(sample(tps_indel$STBP,length(fps_indel$STBP)), fps_indel$STBP)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("STBP data not available")
}
```

### SSSB

```{r}
if ("SSSB" %in% colnames(tps_indel) & "SSSB" %in% colnames(fps_indel)){
  jaccard_idx = jaccard(tps_indel$SSSB, fps_indel$SSSB)
  if (length(tps_indel$SSSB) >= length(fps_indel$SSSB)){
    cosine_sim = cosine_similarity(sample(tps_indel$SSSB,length(fps_indel$SSSB)), fps_indel$SSSB)
  }else{
    cosine_sim = "Not available"
  }
  parameters = data.frame(Jaccard_index = jaccard_idx, Cosine_similarity = cosine_sim)
  datatable(as.data.frame(parameters), filter = "top", rownames = FALSE)
}else{
  print("SSSB data not available")
}
```

3D plots {data-orientation=column}
=======================================================================

Column
-----------------------------------------------------------------------

### SNVs

```{r}
axx <- list(
  title = "VAF"
)

axy <- list(
  title = "QD"
)

axz <- list(
  title = "DP"
)
fig <- plotly::plot_ly(snvs, x = ~VAF, y = ~QD, z = ~DP, color = ~class, colors = c('#BF382A', '#00FF00'),hoverinfo = 'text',
        text = ~paste(class,
                      '</br></br>',"VAF: ", VAF,'</br></br>',"QD: ", QD,'</br></br>', "DP: ",DP)) 
fig <- fig %>% add_markers()
fig <- fig %>% layout(scene = list(xaxis=axx,yaxis=axy,zaxis=axz))


fig

```

Column 
-----------------------------------------------------------------------

### INDELs

```{r}
axx <- list(
  title = "VAF"
)

axy <- list(
  title = "QD"
)

axz <- list(
  title = "DP"
)
fig <- plotly::plot_ly(indels, x = ~VAF, y = ~QD, z = ~DP, color = ~class, colors = c('#BF382A', '#00FF00'),hoverinfo = 'text',
        text = ~paste(class,
                      '</br></br>',"VAF: ", VAF,'</br></br>',"QD: ", QD,'</br></br>', "DP: ",DP)) 
fig <- fig %>% add_markers()
fig <- fig %>% layout(scene = list(xaxis=axx,yaxis=axy,zaxis=axz))
fig

```

